### 키워드

`가용성`, `이중화`, `다중화`, `로드 밸런싱`

### 시작하기 전에

1. **가용성** : 안정성을 수치로 표현하는 것
2. 안정성을 높이기 위한 방법
   1. **이중화**와 **다중화** : 물리적 장비나 프로그램을 여러 개 두는 기술
   2. **로드 밸런싱** : 트래픽을 고르게 분산하는 기술

# 가용성

**안전성이란?**
특정 기능을 언제든 균일한 성능으로 수행할 수 있는 특성
ex. 안정적인 웹 서버 : 언제든지 응답 메시지를 제공할 수 있는 서버
**안정성을 수치화하기**

1. **가용성(availability)**
   - 컴퓨터 시스템이 특정 기능을 실제로 수행할 수 있는 시간의 비율
     $$
     가용성 = \frac{업타임}{업타임 + 다운타임}
     $$
   - 업타임 : 정상적인 사용 시간
   - 다운타임 : 정상적인 사용이 불가능한 시간
   - 가용성이 높은 성질을 **고가용성(HA)**이라고 한다.
2. **고가용성(high availability)**
   - 일반적은 안정적이라고 평가받는 시스템은 가용성이 99.999% 이상인 것을 목표로 한다 - 99.999% = 파이브 나인스
     **가용성을 높이는 방법**

- 다운타임을 낮추어야 한다.
- 문제가 발생하더라도 계속 기능할 수 있도록 설계한다 (=**결함 감내**)

# 이중화

## 이중화

**이중화란?**

- 무언가를 이중으로 두는 기술
- 결함을 감내하여 가용성을 높이기 위한 가장 기본적이고 대표적인 방법
  - 예비(백업)를 마련하는 방법
    **이중화할 수 있는 대상**
- 문제가 발생할 경우 시스템 전체가 중단될 수 있는 대상 (**단일 장애점; SPOF**)
  - 물리적 장비 : 서버 컴퓨터, 네트워크 인터페이스(NIC), 스위치
  - 프로그램 : 데이터베이스, 웹 서버 프로그램
    **이중화 구성의 방식**

1. 액티브/스탠바이
   - 한 시스템은 가동하고, 다른 시스템은 백업 용도로 대기 상태로 둔다.
   - 액티브 상태인 시스템에 문제가 발생할 경우, 스탠바이 시스템이 자동으로 액티브 시스템을 대신하여 동작한다 (**페일오버; failover**)
   - 안전하지만, 하나의 장비를 사용할 때에 비해 성능상의 큰 변화를 기대하기는 어렵다
2. 액티브/액티브
   - 두 시스템 모두를 가동 상태로 둔다
   - 부하를 분산시킬 수 있고, 두 시스템이 함께 가동되므로 성능상의 이점도 있다
   - 한 시스템에 문제 발생시 다른 시스템에 부하가 급증할 수 있으며, 이로 인해 추가적인 문제가 발생할 수 있다.

## 다중화

**다중화란?**

- 무언가를 다중으로 두는 기술. 이중화에 비해 더욱 안정적인 운영이 가능함

## 이중화/다중화의 사례

- **티밍(teaming)**과 **본딩(bonding)**
  - 전자는 윈도우에서 사용, 후자는 리눅스에서 사용
  - 여러 개의 NIC를 이중화/다중화하여 마치 더 뛰어나고 안정적인 성능을 보유한 하나의 인터페이스처럼 보이게 하는 기술

# 로드 밸런싱

**트래픽이란?**

- 주어진 시점에 특정 노드를 경유한 패킷의 양
- 과도한 트래픽은 서버의 가용성을 떨어뜨린다
  - 특정 서버에만 트래픽이 몰릴 경우 서버를 다중화해도 마찬가지로 가용성이 떨어짐
  - 따라서 트래픽을 여러 서버에 고르게 분산해야 한다
    **로드밸런싱**
- 트래픽의 고른 분배를 위해 사용하는 기술
- **로드 밸런서**에 의해 수행된다
  - 하드웨어: L4 스위치, L7 스위치
  - 소프트웨어: HAProxy, Envoy, Nginx
- 로드밸런서는 일반적으로 이중화나 다중화된 서버와 클라이언트 사이에 위치한다. 로드밸런서는 받은 요청을 각 서버에 균등하게 분배한다.
<aside>
💡
**헬스 체크**
- 다중화된 서버 환경에서는 현재 문제가 있는 서버는 없는지, 현재 요청에 대해 올바른 응답을 할 수 있는 상태인지를 주기적으로 검사한다 (=헬스 체크)
- 헬스 체크는 주로 로드밸런서에 의해 이뤄지며, HTTP, ICMP 등 다양한 프로토콜을 활용할 수 있다
- 헬스 체크 외에도 서버 간 **하트비트(heartbeat)**라는 메시지를 주기적으로 주고받으며 문제를 파악할 수도 있다.
</aside>
**로드 밸런싱 알고리즘**
- 부하가 균등하게 분산되도록 부하 대상을 선택하는 방법
- 종류
  1. **라운드 로빈 알고리즘**
     - 단순히 서버를 돌아가며 부하를 전달
     - **가중치 라운드 로빈 알고리즘**
       - 서버마다 가중치를 부여해, 가중치가 높은 서버가 더 많이 선택되어 더 많은 부하를 받도록 한다.
       - 서버 간 성능이 다른 경우 사용한다.
  2. **최소 연결 알고리즘**
     - 연결이 적은 서버부터 우선적으로 부하 전달
     - **가중치 최소 연결 알고리즘**
       - 서버마다 가중치를 부여해, 가중치가 높은 서버가 더 많이 선택되어 더 많은 부하를 받도록 한다.
       - 서버 간 성능이 다른 경우 사용한다.
  3. 무작위로 고름
  4. 해시 이용
  5. 응답시간이 가장 짧은 서버 선택
  <aside>
  💡
  **포워드 프록시와 리버스 프록시**
- 오리진 서버
  - 중간 서버가 아닌, 클라이언트가 최종적으로 메시지를 주고받는 대상
- HTTP 중간 서버의 유형
  1. **프록시 (포워드 프록시)**
  2. **게이트웨이 (리버스 프록시)**
- **프록시**란?
  ![image.png](https://i.esdrop.com/d/f/8kAPQNuGai/fFKuJcBHse.png)
  - **클라이언트가 선택**한 메시지 전달 대리자
  - 프록시를 언제 어떻게 사용할지는 클라이언트가 선택한다. → 일반적으로 프록시는 오리진 서버보다 **클라이언트와 더 가까이** 위치함
  - 주로 캐시 저장, 클라이언트 암호화 및 접근 제한 등의 기능 제공
- **게이트웨이**란?
  ![image.png](https://i.esdrop.com/d/f/8kAPQNuGai/ePrLbYbt5J.png) - 아웃바운드 연결에 대해 **오리진 서버 역할**을 하지만 수신된 요청을 변환하여 다른 인바운드 서버들로 전달하는 중개자 역할을 한다. - 일반적으로 게이트웨이는 **오리진 서버들과 더 가까이** 위치함 - 캐시를 저장할 수 있고, 로드 밸런서로 동작할 수 있음
  </aside>
