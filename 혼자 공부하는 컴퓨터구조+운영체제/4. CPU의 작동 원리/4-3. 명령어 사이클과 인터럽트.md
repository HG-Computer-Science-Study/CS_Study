### 키워드

`명령어 사이클`, `인터럽트`, `예외`, `하드웨어 인터럽트`, `인터럽트 서비스 루틴`

### 시작하기 전에

- **명령어 사이클** : 하나의 명령어를 처리하는 정형화된 흐름
- **인터럽트** : CPU의 명령어 사이클이 깨지는 것

# 명령어 사이클

- **명령어 사이클** : 프로그램 속 명령어들이 반복되며 실행되는 주기
- 명령어 사이클의 구성
  1. **인출 사이클** : 메모리에 있는 명령어를 CPU로 가지고 오는 단계
     1. **간접 사이클** : 명령어를 실행하기 위해 메모리 접근을 한번 더 해야하는 경우 거치는 단계 (ex. 간접 주소 지정 방식)
  2. **실행 사이클** : 명령어를 실행하는 단계

# 인터럽트

- **인터럽트** : CPU의 작업을 방해하는 신호
- 인터럽트의 종류
  1. **동기 인터럽트 (=예외)** : CPU에 발생하는 인터럽트
     - CPU가 실행하는 프로그래밍상의 오류와 같은 예외적인 상황에 마주쳤을 때 발생
  2. **비동기 인터럽트 (=하드웨어 인터럽트)** : 주로 입출력장치에 의해 발생하는 인터럽트
     - ex. 작업을 끝낸 프린터가 CPU에게 완료 알림(인터럽트)을 보내는 것
     - 비동기 인터럽트의 종류
       1. 막을 수 있는 인터럽트
       2. 막을 수 없는 인터럽트 (정전, 하드웨어 고장 등)

## 하드웨어 인터럽트

- CPU는 입출력 작업 도중에도 **효율적으로 명령어를 처리**하기 위해 알림과 같은 하드웨어 인터럽트를 사용한다.
  - 프린트 완료 여부를 CPU가 계속 확인하는 것은 비효율적이다
  - 프린트가 완료되었을 때 인터럽트(알림)를 발생시켜서 CPU가 그 시점에 알도록 하면, 프린트가 작업을 하는 동안 CPU는 다른 작업을 처리할 수 있다.

## 하드웨어 인터럽트 처리 순서

- 하드웨어 인터럽트 처리 순서
  1. 입출력장치가 CPU에 **인터럽트 요청 신호**를 보낸다
  2. CPU는 실행 사이클이 끝나고 명령어를 인출하기 전 인터럽트 여부를 확인한다 (항상)
  3. CPU는 인터럽트 요청을 확인하고 **인터럽트 플래그**를 통해 현재 인터럽트를 받아들일 수 있는지 확인한다
  4. 인터럽트를 받아들일 수 있다면 CPU는 지금까지의 작업을 백업한다
  5. CPU는 **인터럽트 벡터**를 참조하여 **인터럽트 서비스 루틴**을 실행한다
  6. 인터럽트 서비스 루틴 실행이 끝나면 백업해 둔 작업을 복구하여 실행을 재개한다

### 기억해야 할 용어

- **인터럽트 요청 신호** : 하드웨어가 인터럽트 전에 인터럽트 가능 여부를 질의하는 것
- **인터럽트 플래그** : 하드웨어 인터럽트를 받아들일지, 무시할지 결정하는 비트
  - CPU가 중요한 작업을 처리해야 하거나 방해를 받지 말아야 할 때 인터럽트 플래그가 불가능으로 설정된다.
  - 인터럽트 플래그는 CPU의 플래그 레지스터에 있다
  - 우선순위가 높은 인터럽트(정전, 하드웨어 고장 등)는 인터럽트 플래그가 불가능으로 설정되어 있더라도 무시할 수 없다.
- **인터럽트 서비스 루틴 (=인터럽트 핸들러)** : 인터럽트를 처리하기 위한 프로그램
  - 인터럽트 발생시 해당 인터럽트를 어떻게 처리하고 작동해야 할지에 대한 정보가 있음
    ![image (8)](https://github.com/user-attachments/assets/5f905176-f5f0-4829-aea1-77600296bd70)
  - 입출력 장치마다 각기 다른 인터럽트 서비스 루틴이 있음
- **인터럽트 벡터** : 인터럽트 서비스 루틴의 시작 주소를 포함하는 인터럽트 서비스 루틴의 식별 정보
  - 하드웨어는 인터럽트 요청과 인터럽트 벡터를 CPU에게 전달한다
  - CPU는 인터럽트 벡터를 통해 해당 하드웨어의 인터럽트 서비스 루틴의 시작 주소를 알 수 있다.
- 인터럽트 발생시 CPU는 프로그램 카운터 값 등 현재 프로그램을 재개하기 위해 필요한 모든 내용을 스택에 백업한다.
  ![image (9)](https://github.com/user-attachments/assets/802fb03f-64e9-498c-bb79-ae96acd7d355)

<aside>
💡

**예외의 종류**

- 동기 인터럽트(예외)의 종류
  1. 폴트
  2. 트랩
  3. 중단
  4. 소프트웨어 인터럽트
- **폴트** : 예외 처리 직후 **예외가 발생한 명령어부터** 실행을 재개하는 예외
- **트랩** : 예외 처리 직후 **예외가 발생한 명령어의 다음 명령어부터** 실행을 재개하는 예외
- **중단** : CPU가 실행 중인 프로그램을 강제로 중단시킬 수밖에 없는 심각한 오류 발생시 발생
- **소프트웨어 인터럽트** : 시스템 호출이 발생했을 때 일어남
</aside>
