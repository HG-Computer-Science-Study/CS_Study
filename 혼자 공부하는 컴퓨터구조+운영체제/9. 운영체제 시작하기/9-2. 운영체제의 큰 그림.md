### 키워드

`커널`, `이중 모드`, `시스템 호출`, `운영체제 서비스`

# 운영체제의 심장, 커널

- **커널** : 운영체제의 핵심 서비스를 담당하는 부분
  - 핵심 서비스 : 자원에 접근하고 조작하는 기능, 프로그램이 올바르고 안전하게 실행되게 하는 기능
- **사용자 인터페이스** : 운영체제가 제공하는 서비스 중 커널에 포함되지 않는 서비스로, 사용자가 컴퓨터와 상호작용할 수 있는 통로
  - 그래픽 유저 인터페이스(GUI)
  - 커맨드 라인 인터페이스(CLI)

# 이중 모드와 시스템 호출

- 운영체제는 응용 프로그램이 하드웨어 자원에 직접 접근하는 것을 방지하여 자원을 보호한다
- 응용 프로그램이 자원에 접근하기 위해서는 운영체제에 도움을 요청해야 하며, 운영체제는 대신 자원에 접근한다.
  ![Image](https://github.com/user-attachments/assets/738253e9-ff42-4ae7-a575-005cb7f4fd2d)

### 1) 이중 모드

- **이중 모드** : CPU가 명령어를 실행하는 모드를 사용자 모드와 커널 모드로 구분하는 방식
- **사용자 모드** : 운영체제 서비스를 제공받을 수 없는(커널 영역의 코드를 실행할 수 없는) 실행 모드
  - 일반적인 응용 프로그램은 사용자 모드로 실행된다.
  - 자원에 접근할 수 없다
- **커널 모드** : 운영체제 서비스를 제공받을 수 있는(커널 영역의 코드를 실행할 수 있는) 실행 모드
  - 자원에 접근하는 명령어를 비롯한 모든 명령어 실행 가능
  - 플래그 레지스터 속 슈퍼바이저 플래그를 통해 사용자 모드로 실행 중인지, 커널 모드로 실행중인지 알 수 있다

### 2) 시스템 호출

- **시스템 호출(system call)** : 운영체제 서비스를 제공받기 위해 커널 모드로 전환하는 방법
  - 시스템 호출은 **소프트웨어 인터럽트**다.
- CPU가 시스템 호출을 처리하는 순서
  ![Image](https://github.com/user-attachments/assets/d8e835a6-b1fe-4aa2-8ae8-365fa0969ad1)
  - 한 응용 프로그램이 하드 디스크에 데이터를 저장하려고 할 때, 사용자 모드로 실행되는 동안에는 자원(하드 디스크)에 접근할 수 없다
    1. 하드 디스크에 데이터를 저장하는 시스템 호출을 발생시켜 커널 모드로 전환
    2. 운영체제 내의 ‘하드 디스크에 데이터를 저장하는 코드’ 실행
    3. 사용자 모드로 복귀
- 일반적으로 응용 프로그램은 빈번하게 시스템 호출을 발생시키고 사용자 모드와 커널 모드를 오가며 실행된다

# 운영체제(커널)의 핵심 서비스

- 핵심 서비스 : 프로세스 관리, 자원 접근 및 할당, 파일 시스템 관리

## 1) 프로세스 관리

- **프로세스** : 실행 중인 프로그램
- CPU는 각 프로세스를 조금씩 번갈아 가며 실행한다.
  - 하나의 CPU는 한 번에 하나의 프로세스만 실행할 수 있음
- 여러 프로세스가 동시에 실행되는 환경에서 해결해야 하는 문제
  - **프로세스 동기화 (12장)**
  - **교착 상태 (13장)**

## 2) 자원 접근 및 할당

- 자원 : CPU, 메모리, 입출력장치

1. **CPU**
   - **CPU 스케줄링 (11장)** : 프로세스들에 공정하게 CPU를 할당하기 위해 어떤 프로세스부터 CPU를 이용하게 할 것인지, 얼마나 오래 CPU를 이용하게 할지 결정하는 것
2. **메모리**
   - 운영체제가 프로세스에게 어떻게 메모리를 할당하는지, 메모리가 부족할 경우 이를 어떻게 극복하는지? (14장)
3. **입출력장치**
   - **인터럽트 서비스 루틴**과 **하드웨어 인터럽트**는 운영체제가 제공하는 기능으로 커널 영역에 있다.

## 3) 파일 시스템 관리

- **파일 시스템 (15장)**도 운영체제가 지원하는 핵심 서비스

<aside>
💡

**가상 머신과 이중 모드의 발전**

- **가상 머신** : 소프트웨어적으로 만들어낸 가상 컴퓨터.
  - 가상 머신을 설치하면 새로운 운영 체제와 응용 프로그램을 설치하고 실행할 수 있다.
- 가상 머신 또한 응용 프로그램이기 때문에 사용자 모드로 작동한다.
- 가상 머신이 사용자 모드에서 실행될 때, 하드웨어 자원이나 특권 명령을 사용하려면 커널 모드로 전환해야 한다 → **성능 저하 발생, 자원의 관리도 복잡해짐**
- 이 문제를 해결하기 위해 최근의 CPU는 기존의 커널 모드, 사용자 모드 외에 **하이퍼바이저 모드**도 지원한다.
- 하이퍼바이저 모드 - 여러 가상머신이 **공존**하며 각각의 운영체제가 독립적으로 실행될 수 있도록 설계됨 - 하이퍼바이저 모드는 **더 높은 특권 수준**을 가지고 각 가상머신이 자신의 커널 모드를 사용할 수 있도록 분리해준다 - 따라서 **보안성과 격리성**이 강화되며, 여러 가상머신이 물리 자원을 안전하고 효율적으로 공유할 수 있다
</aside>

<aside>
💡

**시스템 호출의 종류**

- POSIX(리눅스, 유닉스) 운영체제 기준
- 프로세스 관리
  | **시스템 호출** | **설명** |
  | --------------- | ------------------------------------ |
  | fork() | 새 자식 프로세스 생성 |
  | execve() | 프로세스 실행 (메모리 공간 덮어쓰기) |
  | exit() | 프로세스 종료 |
  | waitpid() | 자식 프로세스가 종료할 때까지 대기 |
- 파일 관리
  | **시스템 호출** | **설명** |
  | --------------- | -------------- |
  | open() | 파일 열기 |
  | close() | 파일 닫기 |
  | read() | 파일 읽기 |
  | write() | 파일 쓰기 |
  | stat() | 파일 정보 획득 |
- 디렉터리 관리
  | **시스템 호출** | **설명** |
  | --------------- | ----------------------- |
  | chdir() | 작업 디렉터리 변경 |
  | mkdir() | 디렉터리 생성 |
  | rmdir() | 비어 있는 디렉터리 삭제 |
- 파일 시스템 관리
  | **시스템 호출** | **설명** |
  | --- | --- |
  | mount() | 파일 시스템 마운트 |
  | umount() | 파일 시스템 마운트 해제 |
  </aside>
