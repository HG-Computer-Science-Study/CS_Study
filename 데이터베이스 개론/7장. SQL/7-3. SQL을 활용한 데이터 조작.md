# 1. SQL 의 데이터 조작 기능

- 다음 4가지 명령어로 조작이 가능하다.
    - `SELECT`
    - `INSERT`
    - `UPDATE`
    - `DELETE`

# 2. 데이터의 검색

- 테이블에서 원하는 데이터를 검색하기 위해 필요한 SQL 문이다.

## 기본 검색

```sql
SELECT [ALL | DISTINCT] 속성_리스트
FROM 테이블_리스트;
```

- 기본 값은 `ALL` 이며, `DISTINCT`의 경우 중복 값을 제거해서 조회한다.
- 테이블에 존재하는 모든 속성을 검색하려면 `*`을 사용하면 된다. 속성의 순서는 원본 테이블에서 정의한 속성 순서와 같다.

```sql
SELECT * FROM 테이블_리스트
```

- AS 키워드를 사용해서 별칭을 지어줄 수 있다. 실제로 속성의 이름이 바뀌는건 아니고, SELECT 문의 결과 테이블에서만 지정된 별칭으로 출력된다. AS는 생략할 수 있다.

```sql
SELECT 제품명, 단가 [AS] 가격
FROM 테이블_리스트
```

## 조건 검색

- 조건을 만족하는 데이터만 검색하기 위해  `WHERE` 문을 사용한다.

```sql
SELECT 주문제품, 수량, 주문일자
FROM 주문
WHERE 주문고객 = 'apple' AND 수량 >= 15;
```

- 비교 연산자
    - `=, ≥, ≤, <,>, <> (같지 않다)`
- 논리 연산자
    - `AND, OR, NOT`

## LIKE을 이용한 탐색

- **문자열에 대해서** 검색 조건을 부분적으로만 알고 있다면 LIKE 문을 사용할 수 있다.

```sql
LIKE '데이터%' // 데이터로 시작하는 문자열

LIKE '%데이터' // 데이터로 끝나는 문자열

LIKE '%데이터%' // 데이터가 포함된 문자열

LIKE '데이터__' // 데이터로 시작하는 5글자 문자열

LIKE '__한%' // 3번째 글자가 한인 문자열
```

## NULL을 이용한 탐색

- 검색 조건에서 특정 속성의 값이 널 값인지 비교하려면 `IS NULL` 을 사용한다. 반대의 경우에는 `IS NOT NULL`을 사용한다.

```sql
// 고객 테이블에서 나이가 입력되지 않은 고객의 고객 이름 구하기
SELECT 고객이름
FROM 고객
WHERE 나이 IS NULL;

// 고객 테이블에서 나이가 입력된 고객의 고객 이름 구하기
SELECT 고객이름
FROM 고객
WHERE 나이 IS NOT NULL
```

## 정렬 검색

- SELECT문의 경우 일반적으로 DBMS가 정한 순서로 출력된다.
- 결과 테이블을 사용자가 원하는 순서로 출력하려면 `ORDER BY` 키워드를 사용한다.
- 기본적으로 오름차순이고, 내림차순을 원한다면 `DESC`을 추가한다.

```sql
// 나이를 기준으로 오름차순
SELECT 고객이름, 나이
FROM 고객
ORDER BY 나이 [ASC];

// 나이를 기준으로 내림차순
SELECT 고객이름, 나이
FROM 고객
ORDER BY 나이 DESC;

// 주문제품을 기준으로 오름차순, 주문제품이 같다면 수량으로 내림차순
SELECT 주문고객, 주문제품, 수량, 주문일자
FROM 주문
WHERE 수량 >= 10
ORDER BY 주문제품, 수량 DESC;
```

## 집계 함수를 이용한 검색

- 대표적으로 SELECT 문과 함께 사용되는 5가지 집계 함수를 보자.

| 함수 | 의미 | 사용 가능한 타입 |
| --- | --- | --- |
| COUNT | 속성 값의 개수 | 모든 데이터 |
| MAX | 속성 값의 최대값 | 모든 데이터 |
| MIN | 속성 값의 최소값 | 모든 데이터 |
| SUM | 속성 값의 합계 | 숫자 데이터 |
| AVG | 속성 값의 평균 | 숫자 데이터 |
- 집계 함수를 NULL 인 속성 값은 제외하고 계산한다.
- 집계 함수를 WHERE 절에는 사용할 수 없고, SELECT 절이나 HAVING 절에만 사용할 수 있다.

```sql
// 속성의 이름을 따로 지정해주지 않으면 그대로 출력된다.
SELECT SUM(재고량) AS "재고량 합계"
FROM 제품
WHERE 제조업체 = '한빛제과';
```

- `COUNT()` 함수의 경우 속성에 NULL 값이 있다면 제대로 개수를 세지 못하기 때문에 `COUNT(기본키)`,`COUNT(*)` 을 사용한다.
- 중복을 없애고 세고 싶다면 `SELECT COUNT(DISTINCT 제조업체) AS “제조업체 수”` 와 같이 표현한다.

## 그룹별 검색

- 테이블에서 특정 속성의 값이 같은 투플을 모아 그룹을 만들고, 그룹별로 검색을 하기 위해 `GROUP BY` 을 사용한다.

```sql
// 제조업체별로 제조한 제품의 개수와 제품 중 가장 비싼 단가를 검색하자. 조건은 제품의 개수가 3개 이상인 경우만 출력하자.
SELECT 제조업체, COUNT(*) AS 제품수, MAX(단가) AS 최고가
FROM 제품
GROUP BY 제조업체 HAVING COUNT(*) >= 3;

// 각 주문고객이 주문한 제품의 총주문수량을 주문제품별로 검색하자.
SELECT 주문제품, 주문고객, SUM(수량) AS 총주문수량
FROM 주문
GROUP BY 주문제품, 주문고객;
```

- 그룹에 대한 조건은 `WHERE`가 아니라 `HAVING`을 사용한다.

## 여러 테이블에 대한 조인 검색

- 여러 테이블을 연결하여 데이터를 검색하는 것을 조인 검색이라고 한다.
- 테이블을 조인하기 위해서는 조인 속성의 이름은 달라도 도메인은 반드시 같아야 한다.
- 일반적으로는 테이블의 관계를 나타내는 외래키를 조인 속성으로 이용한다.

```sql
// 제품, 주문 테이블을 조인한다.
SELECT 제품.제품명
FROM 제품, 주문
WHERE 주문.주문고객 = 'banana' AND 제품.제품번호 = 주문.주문제품;
```

- 테이블마다 별칭을 사용해서 테이블 이름을 대체할 수도 있다.
- 해당 조인의 경우 조인 속성의 값이 같은 투플에 대해서만 검색을 수행하기에 동등 조인에 해당한다. 만약 조인 조건을 만족하지 않는 투플에 대해서도 검색을 수행하려면 외부 조인을 사용한다. `(Left,Right,Full Outer Join)`
- 여기서 Outer 는 생략이 가능하다.
- 조인문의 조건은 `ON` 을 사용한다.

```sql
SELECT 고객.고객이름, 주문.주문제품, 주문.주문일자
FROM 주문
RIGHT [OUTER] JOIN 고객
	ON 주문.주문고객 = 고객.고객아이디;
```

## 부속 질의문을 이용한 검색

- SELECT 문 안에 또 다른 SELECT 문을 포함시킬 수 있다. 안에 들어있는 SELECT 문을 **부속 질의문**, 또는 **서브 질의문**이라고 한다.

```sql
SELECT 제품명, 단가
FROM 제품
WHERE 제조업체 = (SELECT 제조업체
                FROM 제품
                WHERE 제품명 = '달콤비스킷');
```

- 다음과 같이 작성된 경우 서브 쿼리를 먼저 실행하고 이를 바탕으로 메인 쿼리가 실행된다.
- 단일 행 서브 쿼리의 경우 일반 비교 연산자 을 사용할 수 있고, 다중 행 서브 쿼리의 경우에는 사용할 수 없다.
    - 대신 `IN, NOT IN, EXISTS, NOT EXIST, ALL(비교 연산자와 같이), ANY or SOME(비교 연산자와 같이)` 을 사용해야 한다.

```sql
// 대한식품이 제조한 모든 제품의 단가보다 비싼 제품의 제품명, 단가, 제조업체를 검색하자.
SELECT 제품명, 단가, 제조업체
FROM 제품
WHERE 단가 > ALL (SELECT 단가
							FROM 제품
							WHERE 제조업체 = '대한식품');
```

# 3. 데이터의 삽입

```sql
INSERT
INTO 고객(고객아이디, 고객이름, 나이, 등급, 직업, 적립금)
VALUES ('strawberry','최유경',30,'vip','공무원',100);

// 직업을 모르는 경우 NULL로 대입할 수도 있다. (NOT NULL 이면 대입할 수 없다)
INSERT
INTO 고객
VALUES ('strawberry','최유경',30,'vip',NULL,100);

// 서브 쿼리의 결과를 한빛제품 테이블에 삽입한다.
INSERT 
INTO 한빛제품(제품명, 재고량, 단가)
SELECT 제품명, 재고량, 단가
FROM 제품
WHERE 제조업체 = '한빛제과';
```

# 4. 데이터의 수정

```sql
UPDATE 제품
SET 제품명 ='초코파이'
WHERE 제품번호 = 'p03';

// UPDATE 문은 따로 조건을 지정할 수 없어서 서브 쿼리로 원하는 속성만 수정해야 한다.
UPDATE 주문
SET 수량 = 5
WHERE IN (SELECT 고객아이디
            FROM 고객
            WHERE 고객이름 = '정소화');
```

# 5. 데이터의 삭제

```sql
DELETE 
FROM 주문
WHERE 주문일자 = '2022-05-22';

// DELETE 문은 따로 조건을 지정할 수 없어서 서브 쿼리를 사용해야 함.
DELETE
FROM 주문
WHERE 주문고객 IN (SELECT 고객아이디
                FROM 고객
                WHERE 고객이름 = '정소화');
```